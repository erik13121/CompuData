
@{
    ViewBag.Title = "VehicleBookings";
    Layout = "~/Views/Shared/_Layout.cshtml";
    HttpContext.Current.Response.Cache.SetAllowResponseInBrowserHistory(false);
    HttpContext.Current.Response.Cache.SetCacheability(HttpCacheability.NoCache);
}

<nav id="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="../MainMenu">Home</a></li>
        <li class="breadcrumb-item"><a href="#">Vehicle Menu</a></li>
        <li class="breadcrumb-item active" aria-current="page">Vehicle Bookings</li>
    </ol>
</nav>
@Html.Partial("_ProfilePartial")
<div id="table_background">
    <div id="calendar"></div> 
    @*<div class="container">
        <h2>Vehicle Bookings</h2>

        <div class="agenda">
            <div class="table-responsive">
                <table class="table table-condensed table-bordered">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Reason</th>
                            <th>Project Name</th>
                            <th>Name of Driver</th>
                            <th>Service?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Single event in a single day -->
                        <tr>
                            <td class="agenda-date" class="active" rowspan="1">
                                <div class="dayofmonth">1</div>
                                <div class="dayofweek">Wednesday</div>
                                <div class="shortdate text-muted">August, 2018</div>
                            </td>
                            <td class="agenda-time">
                                5:30 - 6:00 AM
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Book transfer
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Inkululeko Community Centre
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Joel
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    False
                                </div>
                            </td>
                        </tr>

                        <!-- Multiple events in a single day (note the rowspan) -->
                        <tr>
                            <td class="agenda-date" class="active" rowspan="3">
                                <div class="dayofmonth">3</div>
                                <div class="dayofweek">Friday</div>
                                <div class="shortdate text-muted">August, 2018</div>
                            </td>
                            <td class="agenda-time">
                                8:00 - 9:00 AM
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Female Clothes Transfer
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    The Potter's House
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Joel
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    False
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="agenda-time">
                                9:30 AM - 12:00 PM
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Housing Utensil transfer
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Lerato House
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Joel
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    False
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="agenda-time">
                                2:00 - 4:00 PM
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Food Transfer
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Akanani Homelessness Centre
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    Joel
                                </div>
                            </td>
                            <td class="agenda-events">
                                <div class="agenda-event">
                                    False
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="addButton">Add Vehicle Booking</div>*@
    <div id="backButton">Back</div>
</div>
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.print.css" rel="stylesheet" media="print" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gijgo@1.9.6/js/gijgo.min.js" type="text/javascript"></script>
<link href="https://cdn.jsdelivr.net/npm/gijgo@1.9.6/css/gijgo.min.css" rel="stylesheet" type="text/css" />
<style>
    #table_background {
        position: absolute;
        padding: 15px;
        padding-top: 20px;
        padding-bottom: 20px;
        background-color: rgba(128, 128, 128, 0.95);
        height: auto;
        min-width: 600px;
        border-width: 2px;
        border-radius: 50px 50px 50px 50px;
    }

    h2 {
        text-align: center;
    }

    thead {
        background-color: #5a9ad6;
    }

    .agenda {
        background-color: white;
    }

        /* Dates */
        .agenda .agenda-date {
            width: 170px;
        }

            .agenda .agenda-date .dayofmonth {
                width: 40px;
                font-size: 36px;
                line-height: 36px;
                float: left;
                text-align: right;
                margin-right: 10px;
            }

            .agenda .agenda-date .shortdate {
                font-size: 0.75em;
            }


        /* Times */
        .agenda .agenda-time {
            width: 140px;
        }


        /* Events */
        .agenda .agenda-events {
        }

            .agenda .agenda-events .agenda-event {
            }


    #addButton {
        position: relative;
        display: table;
        margin-left: auto;
        bottom: 0;
        z-index: 10000;
        text-decoration: none;
        color: white;
        cursor: pointer;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        box-sizing: border-box;
        border: solid white;
        border-width: 2px;
        border-radius: 50px 50px 50px 50px;
        margin-top: 10px;
        padding: 10px;
        transition: background-color linear 0.5s;
    }

        #addButton:hover {
            background-color: rgba(0, 255, 255, 0.4);
        }

    #backButton {
        position: fixed;
        left: 0;
        bottom: 0;
        z-index: 10000;
        text-decoration: none;
        color: white;
        cursor: pointer;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        margin-left: 2vh;
        box-sizing: border-box;
        border: solid white;
        border-width: 2px;
        border-radius: 50px 50px 50px 50px;
        padding: 10px;
        transition: background-color linear 0.5s;
    }

        #backButton:hover {
            background-color: rgba(0, 255, 255, 0.4);
        }

    #breadcrumb {
        position: absolute;
        top: 0px;
        width: 100%;
    }

    .breadcrumb-item {
        font-size: 25px;
    }

    .breadcrumb {
        top: 0;
        background-color: #33363b !important;
        padding-left: 60px !important;
    }

    #profile {
        position: relative;
        z-index: 7979;
        margin-left: auto;
        margin-bottom: auto;
        height: 61px;
        width: 20%;
        background-color: #33363b;
        transform: translateX(-3px);
    }

        #profile a {
            display: table;
            font-family: 'Raleway', sans-serif;
            font-weight: 200;
            font-size: 25px;
            text-decoration: none !important;
            color: #5a9ad6;
            line-height: 61px;
            vertical-align: middle;
            margin-left: auto;
            margin-right: auto;
        }

    .glyphicon {
        margin-left: 6px;
    }

    .dropdown-menu {
        background-color: #33363b;
    }

        .dropdown-menu li a {
            color: #5a9ad6;
        }

    #vehiclesTable {
        font-size: 15px;
    }
</style>
<script>
    $(function () {
        $(document).ready(function () {
            var events = [];
            //added in for CRUDS
            var selectedEvent = null;
            //FetchEventAndRenderCalender();
            ///////////////////////////////
            $.ajax({
                type: "GET",
                url: "/VehicleBookings/GetEvents",
                success: function (data) {
                    //log the results of OBJECT (data)
                    console.log(JSON.stringify(data));
                    $.each(data, function (i, v) {
                        //log the OBJECT data
                        console.log(i);
                        console.log(v);
                        events.push({
                            brand: v.Brand,
                            model: v.model,
                            numberplate: v.NumberPlate,
                            reason: v.Reason,
                            username: v.UserName,
                            datebooked: moment(v.DateBooked),
                            start: v.StartTime,
                            end: v.EndTime,
                            projectname: v.ProjectName,
                            odoend: v.OdoEnd,
                            intervalid: v.IntervalID,
                            vehiclebookingid: v.VehicleBookingID,
                            //color: blue,
                            allDay: true
                        });
                    })

                    GenerateCalender(events);
                },
                error: function (error) {
                    console.log(error);
                    alert('failed');
                }
            })

            function GenerateCalender(events) {
                $('#calender').fullCalendar('destroy');
                $('#calender').fullCalendar({
                    contentHeight: 400,
                    defaultDate: new Date(),
                    timeFormat: 'h(:mm)a',
                    header: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'month'
                    },
                    eventLimit: true,
                    eventColor: '#378006',
                    events: events,
                    eventClick: function (calEvent, jsEvent, view) {
                        //added in code for CRUDS
                        selectedEvent = calEvent;
                        //////////////////////////
                        $('#myModal #eventTitle').text(calEvent.reason);
                        var $description = $('<div/>');
                        $description.append($('<p/>').html('<b>Start:</b>' + calEvent.start));
                        if (calEvent.end != null) {
                            $description.append($('<p/>').html('<b>End:</b>' + calEvent.end));
                        }

                        $description.append($('<p/>').html('<b>Date Booked for:</b>' + calEvent.datebooked.format("DD-MMM-YYYY")));
                        $description.append($('<p/>').html('<b>Car Brand:</b>' + calEvent.brand));
                        $description.append($('<p/>').html('<b>Car Model:</b>' + calEvent.model));
                        $description.append($('<p/>').html('<b>Car Number Plate:</b>' + calEvent.numberplate));
                        $description.append($('<p/>').html('<b>Reason for Booking:</b>' + calEvent.reason));
                        $description.append($('<p/>').html('<b>Booking is for Project:</b>' + calEvent.projectname));
                        $description.append($('<p/>').html('<b>Odometer end reading on Vehicle after booking:</b>' + calEvent.odoend));
                        if (calEvent.intervalid != null)
                        {
                            $description.append($('<p/>').html('<b>Interval was done in booking:</b>true'));
                        }                        
                        $description.append($('<p/>').html('<b>Part of Booking ID:</b>' + calEvent.vehiclebookingid));

                        $('#myModal #pDetails').empty().html($description);

                        $('#myModal').modal('show');
                    }
                })
            }
        })
    })
</script>